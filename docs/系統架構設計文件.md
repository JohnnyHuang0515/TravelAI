# æ™ºæ…§æ—…éŠè¡Œç¨‹è¦åŠƒç³»çµ± - å®Œæ•´ç³»çµ±æ¶æ§‹è¨­è¨ˆ

**ç‰ˆæœ¬**: v2.0  
**æ›´æ–°æ—¥æœŸ**: 2025-09-30  
**ä¸»è¦ä½¿ç”¨è€…**: è¦åŠƒè¡Œç¨‹çš„é¡§å®¢

---

## ç›®éŒ„

1. [ç³»çµ±æ¦‚è¿°](#1-ç³»çµ±æ¦‚è¿°)
2. [ä½¿ç”¨è€…æµç¨‹è¨­è¨ˆ](#2-ä½¿ç”¨è€…æµç¨‹è¨­è¨ˆ)
3. [ç³»çµ±æ¶æ§‹](#3-ç³»çµ±æ¶æ§‹)
4. [è³‡æ–™åº«è¨­è¨ˆ](#4-è³‡æ–™åº«è¨­è¨ˆ)
5. [API è¨­è¨ˆ](#5-api-è¨­è¨ˆ)
6. [å‰ç«¯é é¢è¨­è¨ˆ](#6-å‰ç«¯é é¢è¨­è¨ˆ)
7. [åŠŸèƒ½æ¨¡çµ„è¨­è¨ˆ](#7-åŠŸèƒ½æ¨¡çµ„è¨­è¨ˆ)
8. [éƒ¨ç½²æ¶æ§‹](#8-éƒ¨ç½²æ¶æ§‹)

---

## 1. ç³»çµ±æ¦‚è¿°

### 1.1 ç³»çµ±å®šä½

æ™ºæ…§æ—…éŠè¡Œç¨‹è¦åŠƒç³»çµ±æ˜¯ä¸€å€‹é¢å‘æ—…éŠæ„›å¥½è€…çš„ SaaS å¹³å°ï¼Œæä¾›ï¼š
- **æ™ºæ…§è¡Œç¨‹è¦åŠƒ**: AI é©…å‹•çš„å€‹æ€§åŒ–è¡Œç¨‹ç”Ÿæˆ
- **æ™¯é»æ¨è–¦**: åŸºæ–¼ä½ç½®çš„æ™ºæ…§æ™¯é»æ¨è–¦
- **æœƒå“¡æœå‹™**: è¡Œç¨‹è¨˜éŒ„ã€å€‹äººåå¥½ç®¡ç†

### 1.2 æ ¸å¿ƒåƒ¹å€¼

- ğŸ¯ **å€‹æ€§åŒ–**: æ ¹æ“šä½¿ç”¨è€…åå¥½ç”Ÿæˆå°ˆå±¬è¡Œç¨‹
- ğŸ¤– **æ™ºæ…§åŒ–**: AI å°è©±å¼äº’å‹•ï¼Œè‡ªç„¶èªè¨€è¦åŠƒ
- ğŸ“ **å³æ™‚æ€§**: åŸºæ–¼ç•¶å‰ä½ç½®çš„æ™¯é»æ¨è–¦
- ğŸ’¾ **è¨˜æ†¶æ€§**: ä¿å­˜æ­·å²è¡Œç¨‹ï¼Œä¾¿æ–¼è¤‡ç”¨èˆ‡åˆ†äº«

### 1.3 æŠ€è¡“æ£§

| åˆ†é¡ | æŠ€è¡“ | èªªæ˜ |
|------|------|------|
| å¾Œç«¯æ¡†æ¶ | Python + FastAPI | é«˜æ€§èƒ½éåŒæ­¥ API |
| è³‡æ–™åº« | PostgreSQL + PostGIS | åœ°ç†ç©ºé–“æŸ¥è©¢ |
| å¿«å– | Redis | å°è©±ç‹€æ…‹ã€äº¤é€šæ™‚é–“å¿«å– |
| AI å¼•æ“ | LangGraph + Gemini/OpenAI | å°è©±å¼ AI è¦åŠƒ |
| è·¯ç¶²è¨ˆç®— | OSRM | äº¤é€šæ™‚é–“è¨ˆç®— |
| å‰ç«¯ | React/Vue + Tailwind CSS | ç¾ä»£åŒ–éŸ¿æ‡‰å¼ UI |

---

## 2. ä½¿ç”¨è€…æµç¨‹è¨­è¨ˆ

### 2.1 ä¸»è¦ä½¿ç”¨è€…è§’è‰²

```mermaid
graph TD
    User[é¡§å®¢] --> Guest[è¨ªå®¢]
    User --> Member[æœƒå“¡]
    
    Guest --> Browse[ç€è¦½æ™¯é»]
    Guest --> Plan[è¦åŠƒè¡Œç¨‹]
    
    Member --> Browse
    Member --> Plan
    Member --> History[æŸ¥çœ‹æ­·å²]
    Member --> Profile[å€‹äººè¨­å®š]
```

### 2.2 æ ¸å¿ƒä½¿ç”¨æµç¨‹

#### æµç¨‹ 1: è¦åŠƒæ–°è¡Œç¨‹

```mermaid
sequenceDiagram
    participant U as ä½¿ç”¨è€…
    participant P1 as é é¢1: åŸºæœ¬è³‡æ–™è¼¸å…¥
    participant P2 as é é¢2: è¡Œç¨‹ç”Ÿæˆèˆ‡ä¿®æ”¹
    participant API as å¾Œç«¯ API
    participant AI as AI è¦åŠƒå¼•æ“
    
    U->>P1: è¨ªå•ç³»çµ±
    P1->>U: é¡¯ç¤ºè¡¨å–®
    U->>P1: è¼¸å…¥: ç›®çš„åœ°ã€å¤©æ•¸ã€æ—¥æœŸã€èˆˆè¶£
    P1->>API: POST /v1/itinerary/propose
    API->>AI: ç”Ÿæˆè¡Œç¨‹
    AI->>API: è¿”å›åˆå§‹è¡Œç¨‹
    API->>P2: è¿”å›è¡Œç¨‹ JSON
    P2->>U: é¡¯ç¤ºå®Œæ•´è¡Œç¨‹
    
    alt ä½¿ç”¨è€…æ»¿æ„
        U->>P2: ç¢ºèªä¸¦å„²å­˜
        P2->>API: POST /v1/trips (æœƒå“¡) æˆ–ä¸‹è¼‰
    else ä½¿ç”¨è€…ä¸æ»¿æ„
        U->>P2: è¼¸å…¥ä¿®æ”¹è¦æ±‚ï¼ˆå°è©±ï¼‰
        P2->>API: POST /v1/itinerary/feedback
        API->>AI: è™•ç†ä¿®æ”¹
        AI->>API: è¿”å›æ›´æ–°å¾Œè¡Œç¨‹
        API->>P2: è¿”å›æ–°è¡Œç¨‹
        P2->>U: é¡¯ç¤ºæ›´æ–°å¾Œè¡Œç¨‹
    end
```

#### æµç¨‹ 2: æ™¯é»æ¨è–¦

```mermaid
sequenceDiagram
    participant U as ä½¿ç”¨è€…
    participant Page as æ™¯é»æ¨è–¦é é¢
    participant API as å¾Œç«¯ API
    participant DB as è³‡æ–™åº«
    
    U->>Page: è¨ªå•ã€Œé™„è¿‘æ™¯é»ã€
    Page->>U: è«‹æ±‚åœ°ç†ä½ç½®æ¬Šé™
    U->>Page: æˆæ¬Šä½ç½®
    Page->>API: GET /v1/places/nearby?lat=...&lon=...
    API->>DB: PostGIS åŠå¾‘æŸ¥è©¢
    DB->>API: è¿”å›é™„è¿‘æ™¯é»åˆ—è¡¨
    API->>Page: æ™¯é»åˆ—è¡¨ï¼ˆå«è·é›¢ã€è©•åˆ†ï¼‰
    Page->>U: é¡¯ç¤ºæ™¯é»å¡ç‰‡
    
    U->>Page: é»æ“Šæ™¯é»
    Page->>U: é¡¯ç¤ºæ™¯é»è©³æƒ…
    
    opt åŠ å…¥è¡Œç¨‹
        U->>Page: é»æ“Šã€ŒåŠ å…¥è¡Œç¨‹ã€
        Page->>API: POST /v1/itinerary/add-place
    end
```

#### æµç¨‹ 3: æœƒå“¡ç³»çµ±

```mermaid
graph TD
    A[ä½¿ç”¨è€…] --> B{æ˜¯å¦ç™»å…¥?}
    B -->|å¦| C[è¨»å†Š/ç™»å…¥é é¢]
    B -->|æ˜¯| D[æœƒå“¡ä¸­å¿ƒ]
    
    C --> E[Google/Email è¨»å†Š]
    E --> F[å»ºç«‹æœƒå“¡è³‡æ–™]
    F --> D
    
    D --> G[æˆ‘çš„è¡Œç¨‹]
    D --> H[å€‹äººè³‡æ–™]
    D --> I[åå¥½è¨­å®š]
    
    G --> J[æª¢è¦–æ­·å²è¡Œç¨‹]
    G --> K[è¤‡è£½è¡Œç¨‹]
    G --> L[åˆ†äº«è¡Œç¨‹]
```

---

## 3. ç³»çµ±æ¶æ§‹

### 3.1 æ•´é«”æ¶æ§‹åœ–

```mermaid
graph TB
    subgraph "å‰ç«¯å±¤ (Frontend)"
        Web[Web æ‡‰ç”¨]
        Mobile[ç§»å‹•ç¶²é ]
    end
    
    subgraph "API å±¤ (API Gateway)"
        Gateway[FastAPI Gateway]
        Auth[èªè­‰ä¸­é–“ä»¶]
    end
    
    subgraph "æ‡‰ç”¨å±¤ (Application Services)"
        TripService[è¡Œç¨‹è¦åŠƒæœå‹™]
        PlaceService[æ™¯é»æœå‹™]
        UserService[æœƒå“¡æœå‹™]
        RecommendService[æ¨è–¦æœå‹™]
    end
    
    subgraph "æ ¸å¿ƒå±¤ (Core Engine)"
        LangGraph[LangGraph ç‹€æ…‹æ©Ÿ]
        Planner[è²ªå©ªè¦åŠƒå™¨]
        Optimizer[2-opt å„ªåŒ–å™¨]
        Retriever[æ··åˆæª¢ç´¢å™¨]
    end
    
    subgraph "åŸºç¤è¨­æ–½å±¤ (Infrastructure)"
        DB[(PostgreSQL)]
        Redis[(Redis)]
        OSRM[OSRM æœå‹™]
        VectorDB[(å‘é‡è³‡æ–™åº«)]
    end
    
    Web --> Gateway
    Mobile --> Gateway
    Gateway --> Auth
    Auth --> TripService
    Auth --> PlaceService
    Auth --> UserService
    Auth --> RecommendService
    
    TripService --> LangGraph
    TripService --> Planner
    PlaceService --> Retriever
    RecommendService --> Retriever
    
    LangGraph --> Retriever
    Planner --> OSRM
    Planner --> Optimizer
    
    Retriever --> DB
    Retriever --> VectorDB
    UserService --> DB
    OSRM --> Redis
    LangGraph --> Redis
```

### 3.2 æŠ€è¡“æ¶æ§‹åˆ†å±¤

| å±¤ç´š | è·è²¬ | ä¸»è¦çµ„ä»¶ |
|------|------|----------|
| **è¡¨ç¾å±¤** | ä½¿ç”¨è€…ä»‹é¢ã€äº’å‹• | React/Vue å…ƒä»¶ã€Tailwind CSS |
| **API å±¤** | è·¯ç”±ã€é©—è­‰ã€é™æµ | FastAPIã€JWT èªè­‰ã€CORS |
| **æ‡‰ç”¨å±¤** | æ¥­å‹™é‚è¼¯ç·¨æ’ | Service é¡ã€Use Cases |
| **é ˜åŸŸå±¤** | æ ¸å¿ƒæ¥­å‹™è¦å‰‡ | Entityã€Value Objectã€Domain Service |
| **åŸºç¤è¨­æ–½å±¤** | è³‡æ–™å­˜å–ã€å¤–éƒ¨æœå‹™ | Repositoryã€OSRM Clientã€LLM Client |

---

## 4. è³‡æ–™åº«è¨­è¨ˆ

### 4.1 ER åœ–

```mermaid
erDiagram
    USERS ||--o{ USER_TRIPS : "æ“æœ‰"
    USERS ||--o{ USER_PREFERENCES : "è¨­å®š"
    USER_TRIPS ||--|{ TRIP_DAYS : "åŒ…å«"
    TRIP_DAYS ||--|{ TRIP_VISITS : "åŒ…å«"
    TRIP_VISITS }o--|| PLACES : "åƒè€ƒ"
    TRIP_DAYS }o--|| ACCOMMODATIONS : "ä½å®¿"
    PLACES ||--o{ HOURS : "ç‡Ÿæ¥­æ™‚é–“"
    PLACES ||--o{ PLACE_EMBEDDINGS : "å‘é‡"
    USERS ||--o{ PLACE_FAVORITES : "æ”¶è—"
    PLACE_FAVORITES }o--|| PLACES : "æ™¯é»"
    
    USERS {
        uuid id PK
        string email UK
        string username
        string password_hash
        string provider
        string provider_id
        jsonb profile
        timestamp created_at
        timestamp last_login
    }
    
    USER_PREFERENCES {
        uuid id PK
        uuid user_id FK
        string[] favorite_themes
        string travel_pace
        string budget_level
        jsonb custom_settings
    }
    
    USER_TRIPS {
        uuid id PK
        uuid user_id FK
        string title
        text description
        string destination
        int duration_days
        date start_date
        date end_date
        jsonb itinerary_data
        boolean is_public
        timestamp created_at
        timestamp updated_at
    }
    
    TRIP_DAYS {
        uuid id PK
        uuid trip_id FK
        int day_number
        date date
        uuid accommodation_id FK
    }
    
    TRIP_VISITS {
        uuid id PK
        uuid trip_day_id FK
        uuid place_id FK
        int visit_order
        time eta
        time etd
        int travel_minutes
    }
    
    PLACES {
        uuid id PK
        string name
        geometry geom
        string[] categories
        string[] tags
        int stay_minutes
        int price_range
        numeric rating
        text description
        jsonb metadata
    }
    
    HOURS {
        uuid place_id FK
        int weekday
        int open_min
        int close_min
    }
    
    ACCOMMODATIONS {
        uuid id PK
        string name
        geometry geom
        string address
        numeric rating
        int price_range
        string[] amenities
    }
    
    PLACE_FAVORITES {
        uuid id PK
        uuid user_id FK
        uuid place_id FK
        timestamp created_at
    }
    
    PLACE_EMBEDDINGS {
        uuid place_id FK
        vector embedding
    }
```

### 4.2 æ ¸å¿ƒè¡¨çµæ§‹

#### 4.2.1 ä½¿ç”¨è€…ç›¸é—œè¡¨

```sql
-- ä½¿ç”¨è€…è¡¨
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    email VARCHAR(255) UNIQUE NOT NULL,
    username VARCHAR(100),
    password_hash VARCHAR(255),  -- å¯†ç¢¼é›œæ¹Š
    provider VARCHAR(50),  -- 'email', 'google', 'facebook'
    provider_id VARCHAR(255),  -- OAuth provider ID
    profile JSONB,  -- {avatar, phone, bio, ...}
    created_at TIMESTAMPTZ DEFAULT NOW(),
    last_login TIMESTAMPTZ,
    is_active BOOLEAN DEFAULT TRUE
);

CREATE INDEX idx_users_email ON users(email);
CREATE INDEX idx_users_provider ON users(provider, provider_id);

-- ä½¿ç”¨è€…åå¥½è¨­å®š
CREATE TABLE user_preferences (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id) ON DELETE CASCADE,
    favorite_themes TEXT[],  -- ['ç¾é£Ÿ', 'è‡ªç„¶', 'æ–‡åŒ–']
    travel_pace VARCHAR(20),  -- 'relaxed', 'moderate', 'packed'
    budget_level VARCHAR(20),  -- 'budget', 'moderate', 'luxury'
    custom_settings JSONB,  -- å…¶ä»–è‡ªè¨‚è¨­å®š
    updated_at TIMESTAMPTZ DEFAULT NOW(),
    UNIQUE(user_id)
);
```

#### 4.2.2 è¡Œç¨‹ç›¸é—œè¡¨

```sql
-- ä½¿ç”¨è€…è¡Œç¨‹è¨˜éŒ„
CREATE TABLE user_trips (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id) ON DELETE CASCADE,
    title VARCHAR(255) NOT NULL,
    description TEXT,
    destination VARCHAR(255),  -- ä¸»è¦ç›®çš„åœ°
    duration_days INT NOT NULL,
    start_date DATE,
    end_date DATE,
    itinerary_data JSONB NOT NULL,  -- å®Œæ•´çš„è¡Œç¨‹ JSON
    is_public BOOLEAN DEFAULT FALSE,  -- æ˜¯å¦å…¬é–‹åˆ†äº«
    view_count INT DEFAULT 0,  -- ç€è¦½æ¬¡æ•¸
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_user_trips_user_id ON user_trips(user_id);
CREATE INDEX idx_user_trips_created ON user_trips(created_at DESC);
CREATE INDEX idx_user_trips_public ON user_trips(is_public) WHERE is_public = TRUE;

-- è¡Œç¨‹å¤©æ•¸æ˜ç´°
CREATE TABLE trip_days (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    trip_id UUID REFERENCES user_trips(id) ON DELETE CASCADE,
    day_number INT NOT NULL,  -- ç¬¬å¹¾å¤©
    date DATE NOT NULL,
    accommodation_id UUID REFERENCES accommodations(id),
    UNIQUE(trip_id, day_number)
);

-- è¡Œç¨‹æ™¯é»è¨ªå•è¨˜éŒ„
CREATE TABLE trip_visits (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    trip_day_id UUID REFERENCES trip_days(id) ON DELETE CASCADE,
    place_id UUID REFERENCES places(id),
    visit_order INT NOT NULL,  -- ç•¶å¤©çš„è¨ªå•é †åº
    eta TIME NOT NULL,  -- Estimated Time of Arrival
    etd TIME NOT NULL,  -- Estimated Time of Departure
    travel_minutes INT,  -- åˆ°é”è©²æ™¯é»çš„äº¤é€šæ™‚é–“
    notes TEXT,  -- ä½¿ç”¨è€…å‚™è¨»
    UNIQUE(trip_day_id, visit_order)
);

CREATE INDEX idx_trip_visits_place ON trip_visits(place_id);
```

#### 4.2.3 æ™¯é»ç›¸é—œè¡¨ï¼ˆå·²å­˜åœ¨ï¼Œè£œå……èªªæ˜ï¼‰

```sql
-- æ™¯é»è¡¨ï¼ˆå·²å­˜åœ¨ï¼‰
CREATE TABLE IF NOT EXISTS places (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name TEXT NOT NULL,
    geom GEOMETRY(Point, 4326),  -- WGS84 åº§æ¨™
    categories TEXT[],  -- ['ç¾é£Ÿ', 'æ™¯é»', 'ä½å®¿']
    tags TEXT[],  -- ['è¦ªå­', 'ç¶²ç¾', 'æˆ¶å¤–']
    stay_minutes INT DEFAULT 60,
    price_range INT,  -- 1-5
    rating NUMERIC(2,1),  -- 0.0-5.0
    description TEXT,
    address TEXT,
    phone VARCHAR(50),
    website VARCHAR(500),
    photo_urls TEXT[],
    source VARCHAR(50),  -- 'tdx', 'google', 'manual'
    source_id VARCHAR(255),
    metadata JSONB,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX places_geom_idx ON places USING GIST (geom);
CREATE INDEX places_categories_idx ON places USING GIN (categories);
CREATE INDEX places_rating_idx ON places (rating DESC);

-- ä½¿ç”¨è€…æ”¶è—æ™¯é»
CREATE TABLE place_favorites (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id) ON DELETE CASCADE,
    place_id UUID REFERENCES places(id) ON DELETE CASCADE,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    UNIQUE(user_id, place_id)
);

CREATE INDEX idx_favorites_user ON place_favorites(user_id);
```

#### 4.2.4 å°è©±èˆ‡å›é¥‹è¡¨

```sql
-- å°è©± Sessionï¼ˆè£œå……ï¼‰
CREATE TABLE conversation_sessions (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id),  -- å¯ç‚º NULLï¼ˆè¨ªå®¢ï¼‰
    session_id VARCHAR(255) UNIQUE NOT NULL,
    state_data JSONB,  -- LangGraph ç‹€æ…‹
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW(),
    expires_at TIMESTAMPTZ  -- Session éæœŸæ™‚é–“
);

CREATE INDEX idx_sessions_user ON conversation_sessions(user_id);
CREATE INDEX idx_sessions_expires ON conversation_sessions(expires_at);

-- ä½¿ç”¨è€…å›é¥‹è¨˜éŒ„ï¼ˆå·²å­˜åœ¨ï¼Œè£œå……ï¼‰
CREATE TABLE IF NOT EXISTS feedback_events (
    id BIGSERIAL PRIMARY KEY,
    session_id VARCHAR(255),
    user_id UUID REFERENCES users(id),
    trip_id UUID REFERENCES user_trips(id),
    place_id UUID,
    op VARCHAR(20),  -- 'DROP', 'REPLACE', 'MOVE', 'ADD'
    reason TEXT,
    created_at TIMESTAMPTZ DEFAULT NOW()
);
```

---

## 5. API è¨­è¨ˆ

### 5.1 API ç«¯é»ç¸½è¦½

#### 5.1.1 èªè­‰èˆ‡æœƒå“¡ API

| ç«¯é» | æ–¹æ³• | åŠŸèƒ½ | èªè­‰ |
|------|------|------|------|
| `/v1/auth/register` | POST | è¨»å†Šæ–°æœƒå“¡ | âŒ |
| `/v1/auth/login` | POST | ç™»å…¥ | âŒ |
| `/v1/auth/logout` | POST | ç™»å‡º | âœ… |
| `/v1/auth/refresh` | POST | åˆ·æ–° Token | âœ… |
| `/v1/auth/oauth/google` | GET | Google OAuth | âŒ |
| `/v1/users/me` | GET | å–å¾—ç•¶å‰ä½¿ç”¨è€…è³‡æ–™ | âœ… |
| `/v1/users/me` | PUT | æ›´æ–°ä½¿ç”¨è€…è³‡æ–™ | âœ… |
| `/v1/users/me/preferences` | GET | å–å¾—ä½¿ç”¨è€…åå¥½ | âœ… |
| `/v1/users/me/preferences` | PUT | æ›´æ–°ä½¿ç”¨è€…åå¥½ | âœ… |

#### 5.1.2 è¡Œç¨‹è¦åŠƒ API

| ç«¯é» | æ–¹æ³• | åŠŸèƒ½ | èªè­‰ |
|------|------|------|------|
| `/v1/itinerary/propose` | POST | ç”Ÿæˆæ–°è¡Œç¨‹ | âŒ |
| `/v1/itinerary/feedback` | POST | ä¿®æ”¹è¡Œç¨‹ï¼ˆå°è©±ï¼‰ | âŒ |
| `/v1/itinerary/optimize` | POST | å„ªåŒ–è¡Œç¨‹è·¯å¾‘ | âŒ |

#### 5.1.3 æœƒå“¡è¡Œç¨‹ç®¡ç† API

| ç«¯é» | æ–¹æ³• | åŠŸèƒ½ | èªè­‰ |
|------|------|------|------|
| `/v1/trips` | GET | å–å¾—æˆ‘çš„è¡Œç¨‹åˆ—è¡¨ | âœ… |
| `/v1/trips` | POST | å„²å­˜æ–°è¡Œç¨‹ | âœ… |
| `/v1/trips/{trip_id}` | GET | å–å¾—è¡Œç¨‹è©³æƒ… | âœ… |
| `/v1/trips/{trip_id}` | PUT | æ›´æ–°è¡Œç¨‹ | âœ… |
| `/v1/trips/{trip_id}` | DELETE | åˆªé™¤è¡Œç¨‹ | âœ… |
| `/v1/trips/{trip_id}/share` | POST | åˆ†äº«è¡Œç¨‹ | âœ… |
| `/v1/trips/{trip_id}/copy` | POST | è¤‡è£½è¡Œç¨‹ | âœ… |
| `/v1/trips/public/{trip_id}` | GET | æŸ¥çœ‹å…¬é–‹è¡Œç¨‹ | âŒ |

#### 5.1.4 æ™¯é»ç›¸é—œ API

| ç«¯é» | æ–¹æ³• | åŠŸèƒ½ | èªè­‰ |
|------|------|------|------|
| `/v1/places/search` | GET | æœå°‹æ™¯é» | âŒ |
| `/v1/places/nearby` | GET | é™„è¿‘æ™¯é»æ¨è–¦ | âŒ |
| `/v1/places/{place_id}` | GET | å–å¾—æ™¯é»è©³æƒ… | âŒ |
| `/v1/places/favorites` | GET | æˆ‘çš„æ”¶è—æ™¯é» | âœ… |
| `/v1/places/{place_id}/favorite` | POST | æ”¶è—æ™¯é» | âœ… |
| `/v1/places/{place_id}/favorite` | DELETE | å–æ¶ˆæ”¶è— | âœ… |

### 5.2 API è©³ç´°è¨­è¨ˆç¯„ä¾‹

#### 5.2.1 è¨»å†Š API

```http
POST /v1/auth/register
Content-Type: application/json

{
  "email": "user@example.com",
  "password": "SecurePassword123",
  "username": "traveler_john"
}
```

**Response**:
```json
{
  "user": {
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "email": "user@example.com",
    "username": "traveler_john",
    "created_at": "2025-09-30T10:00:00Z"
  },
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "token_type": "bearer"
}
```

#### 5.2.2 ç”Ÿæˆè¡Œç¨‹ API

```http
POST /v1/itinerary/propose
Content-Type: application/json
Authorization: Bearer <token>  (å¯é¸ï¼Œæœƒå“¡å¯äº«å€‹æ€§åŒ–)

{
  "user_input": "æˆ‘æƒ³åœ¨å®œè˜­ç©å…©å¤©ï¼Œå–œæ­¡ç¾é£Ÿå’Œè‡ªç„¶æ™¯è§€",
  "session_id": "session_abc123",
  "user_id": "550e8400-e29b-41d4-a716-446655440000"  (å¯é¸)
}
```

**Response**:
```json
{
  "status": "complete",
  "itinerary": {
    "days": [
      {
        "day": 1,
        "date": "2025-10-01",
        "visits": [
          {
            "place_id": "place_001",
            "name": "ç¾…æ±å¤œå¸‚",
            "eta": "18:00",
            "etd": "20:00",
            "travel_minutes": 0,
            "stay_minutes": 120
          }
        ],
        "accommodation": {
          "name": "å®œè˜­æ°‘å®¿",
          "address": "å®œè˜­ç¸£ç¾…æ±é®..."
        }
      }
    ],
    "summary": {
      "total_days": 2,
      "total_places": 8,
      "estimated_cost": "ä¸­ç­‰"
    }
  },
  "session_id": "session_abc123"
}
```

è‹¥è³‡è¨Šä¸è¶³ï¼š
```json
{
  "status": "need_more_info",
  "question": "è«‹å•æ‚¨è¨ˆç•«å“ªä¸€å¤©å‡ºç™¼å‘¢ï¼Ÿ",
  "collected_info": {
    "destination": "å®œè˜­",
    "duration": 2,
    "interests": ["ç¾é£Ÿ", "è‡ªç„¶"]
  },
  "session_id": "session_abc123"
}
```

#### 5.2.3 é™„è¿‘æ™¯é» API

```http
GET /v1/places/nearby?lat=24.7021&lon=121.9575&radius=5000&limit=20
Authorization: Bearer <token>  (å¯é¸)
```

**Response**:
```json
{
  "places": [
    {
      "id": "place_001",
      "name": "å¹¾ç±³å…¬åœ’",
      "distance_meters": 1200,
      "distance_text": "1.2 å…¬é‡Œ",
      "categories": ["æ™¯é»", "è¦ªå­"],
      "rating": 4.5,
      "stay_minutes": 60,
      "price_range": 1,
      "location": {
        "lat": 24.7021,
        "lon": 121.9575
      },
      "photo_url": "https://...",
      "is_favorite": false
    }
  ],
  "total": 20,
  "user_location": {
    "lat": 24.7021,
    "lon": 121.9575
  }
}
```

#### 5.2.4 å„²å­˜è¡Œç¨‹ API

```http
POST /v1/trips
Content-Type: application/json
Authorization: Bearer <token>

{
  "title": "å®œè˜­å…©æ—¥éŠ",
  "description": "ç¾é£Ÿèˆ‡è‡ªç„¶ä¹‹æ—…",
  "destination": "å®œè˜­",
  "start_date": "2025-10-01",
  "end_date": "2025-10-02",
  "itinerary_data": { ... },  // å®Œæ•´çš„è¡Œç¨‹ JSON
  "is_public": false
}
```

**Response**:
```json
{
  "trip": {
    "id": "trip_001",
    "title": "å®œè˜­å…©æ—¥éŠ",
    "destination": "å®œè˜­",
    "duration_days": 2,
    "created_at": "2025-09-30T10:00:00Z",
    "share_url": "https://app.com/trips/public/trip_001"
  }
}
```

---

## 6. å‰ç«¯é é¢è¨­è¨ˆ

### 6.1 é é¢æ¶æ§‹

```
é¦–é  (/)
â”œâ”€â”€ å°è¦½åˆ—
â”‚   â”œâ”€â”€ Logo
â”‚   â”œâ”€â”€ åŠŸèƒ½é¸å–®ï¼ˆè¦åŠƒè¡Œç¨‹ã€é™„è¿‘æ™¯é»ã€æˆ‘çš„è¡Œç¨‹ï¼‰
â”‚   â””â”€â”€ ä½¿ç”¨è€…å€ï¼ˆç™»å…¥/è¨»å†Šã€é ­åƒï¼‰
â”‚
â”œâ”€â”€ Hero Section
â”‚   â”œâ”€â”€ æ¨™é¡Œèˆ‡ Slogan
â”‚   â””â”€â”€ CTA æŒ‰éˆ•ï¼šã€Œé–‹å§‹è¦åŠƒè¡Œç¨‹ã€
â”‚
â”œâ”€â”€ åŠŸèƒ½ä»‹ç´¹
â”‚   â”œâ”€â”€ æ™ºæ…§è¦åŠƒ
â”‚   â”œâ”€â”€ æ™¯é»æ¨è–¦
â”‚   â””â”€â”€ è¡Œç¨‹ç®¡ç†
â”‚
â””â”€â”€ Footer
    â”œâ”€â”€ é—œæ–¼æˆ‘å€‘
    â”œâ”€â”€ éš±ç§æ”¿ç­–
    â””â”€â”€ è¯çµ¡æˆ‘å€‘
```

### 6.2 æ ¸å¿ƒé é¢è¨­è¨ˆ

#### 6.2.1 é é¢ 1: åŸºæœ¬è³‡æ–™è¼¸å…¥

**è·¯å¾‘**: `/plan/start`

**è¨­è¨ˆè¦é»**:
- ç°¡æ½”çš„å–®é è¡¨å–®
- å³æ™‚é©—è­‰
- é€²åº¦æŒ‡ç¤ºå™¨

**UI çµ„ä»¶**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [Logo]                      [ç™»å…¥] [è¨»å†Š]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚     é–‹å§‹è¦åŠƒä½ çš„å®Œç¾è¡Œç¨‹ ğŸ—ºï¸                  â”‚
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ç›®çš„åœ° *                            â”‚   â”‚
â”‚  â”‚ [å®œè˜­                        â–¼]    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ å‡ºç™¼æ—¥æœŸ *      â”‚  â”‚ å¤©æ•¸ *          â”‚  â”‚
â”‚  â”‚ [2025-10-01]    â”‚  â”‚ [2 å¤©     â–¼]   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ æ—…éŠèˆˆè¶£ï¼ˆå¯å¤šé¸ï¼‰*                  â”‚   â”‚
â”‚  â”‚ [X] ç¾é£Ÿ  [ ] è‡ªç„¶  [X] æ–‡åŒ–        â”‚   â”‚
â”‚  â”‚ [ ] è¦ªå­  [ ] è³¼ç‰©  [ ] å¤œç”Ÿæ´»      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ é ç®—ç¯„åœ                             â”‚   â”‚
â”‚  â”‚ ( ) ç¶“æ¿Ÿ  (â—) ä¸­ç­‰  ( ) è±ªè¯        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ æ—…éŠç¯€å¥                             â”‚   â”‚
â”‚  â”‚ ( ) æ‚ é–’  (â—) é©ä¸­  ( ) ç·Šæ¹Š        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                             â”‚
â”‚          [ç”Ÿæˆè¡Œç¨‹ â†’]                       â”‚
â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 6.2.2 é é¢ 2: è¡Œç¨‹ç”Ÿæˆèˆ‡ä¿®æ”¹

**è·¯å¾‘**: `/plan/result`

**è¨­è¨ˆè¦é»**:
- å·¦å´ï¼šè¡Œç¨‹æ™‚é–“è»¸é¡¯ç¤º
- å³å´ï¼šåœ°åœ–è¦–è¦ºåŒ–
- ä¸‹æ–¹ï¼šå°è©±ä¿®æ”¹ä»‹é¢

**UI å¸ƒå±€**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [Logo]  æˆ‘çš„è¡Œç¨‹                         [ç™»å…¥] [å„²å­˜]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                         â”‚                                 â”‚
â”‚  å®œè˜­å…©æ—¥éŠ              â”‚         [åœ°åœ–è¦–è¦ºåŒ–]             â”‚
â”‚  2025-10-01 ~ 10-02     â”‚                                 â”‚
â”‚                         â”‚      â—â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â—              â”‚
â”‚  ğŸ“… ç¬¬ 1 å¤© (10/01)     â”‚      â”‚     â”‚     â”‚              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚      æ™¯1   æ™¯2   æ™¯3             â”‚
â”‚  â”‚ 09:00-11:00        â”‚â”‚                                 â”‚
â”‚  â”‚ ğŸœ ç¾…æ±å¤œå¸‚         â”‚â”‚                                 â”‚
â”‚  â”‚ â­ 4.5  ğŸ’° $$      â”‚â”‚                                 â”‚
â”‚  â”‚ ğŸš— 15åˆ†é˜          â”‚â”‚                                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚                                 â”‚
â”‚  â”‚ 11:15-13:00        â”‚â”‚                                 â”‚
â”‚  â”‚ ğŸŒ³ å¤ªå¹³å±±          â”‚â”‚                                 â”‚
â”‚  â”‚ â­ 4.8  ğŸ’° $       â”‚â”‚                                 â”‚
â”‚  â”‚ ğŸš— 40åˆ†é˜          â”‚â”‚                                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚                                 â”‚
â”‚                         â”‚                                 â”‚
â”‚  ğŸ¨ ä½å®¿: å®œè˜­æ°‘å®¿      â”‚                                 â”‚
â”‚                         â”‚                                 â”‚
â”‚  ğŸ“… ç¬¬ 2 å¤© (10/02)     â”‚                                 â”‚
â”‚  ...                    â”‚                                 â”‚
â”‚                         â”‚                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ’¬ å°è©±ä¿®æ”¹è¡Œç¨‹                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ä½ : æˆ‘ä¸æƒ³å»å¤ªå¹³å±±ï¼Œæ›æˆæµ·é‚Šæ™¯é»                    â”‚  â”‚
â”‚  â”‚ AI: å¥½çš„ï¼Œæˆ‘å¹«æ‚¨æ›æˆå¤–æ¾³æµ·ç˜ï¼Œè»Šç¨‹ç¸®çŸ­ç‚º20åˆ†é˜ âœ“   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  [è¼¸å…¥ä¿®æ”¹éœ€æ±‚...                               ] [é€å‡º] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å°è©±ä¿®æ”¹åŠŸèƒ½**:
- å³æ™‚ä¿®æ”¹å»ºè­°
- æ­·å²å°è©±è¨˜éŒ„
- å¿«é€Ÿæ“ä½œæŒ‰éˆ•ï¼ˆåˆªé™¤æ™¯é»ã€æ›¿æ›æ™¯é»ã€èª¿æ•´æ™‚é–“ï¼‰

#### 6.2.3 é é¢ 3: é™„è¿‘æ™¯é»æ¨è–¦

**è·¯å¾‘**: `/places/nearby`

**è¨­è¨ˆè¦é»**:
- å³æ™‚å®šä½
- åœ°åœ–+åˆ—è¡¨é›™è¦–åœ–
- ç¯©é¸èˆ‡æ’åº

**UI å¸ƒå±€**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [Logo]  é™„è¿‘æ™¯é»                         [ç™»å…¥] [æˆ‘çš„]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                         â”‚                                 â”‚
â”‚  ğŸ“ æ‚¨çš„ä½ç½®             â”‚         [äº’å‹•åœ°åœ–]              â”‚
â”‚  å®œè˜­ç«è»Šç«™              â”‚                                 â”‚
â”‚                         â”‚      ğŸ“ (æ‚¨)                    â”‚
â”‚  ğŸ” ç¯©é¸                â”‚       â†“ 1.2km                   â”‚
â”‚  [ ] ç¾é£Ÿ               â”‚      â— æ™¯é»1                    â”‚
â”‚  [X] æ™¯é»               â”‚       â†“ 2.5km                   â”‚
â”‚  [ ] è³¼ç‰©               â”‚      â— æ™¯é»2                    â”‚
â”‚                         â”‚                                 â”‚
â”‚  ğŸ¯ åŠå¾‘: [5km   â–¼]    â”‚                                 â”‚
â”‚  ğŸ“Š æ’åº: [è·é›¢  â–¼]    â”‚                                 â”‚
â”‚                         â”‚                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚                                 â”‚
â”‚                         â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚                                 â”‚
â”‚  â”‚ ğŸ“¸ [åœ–ç‰‡]          â”‚â”‚                                 â”‚
â”‚  â”‚ å¹¾ç±³å…¬åœ’            â”‚â”‚                                 â”‚
â”‚  â”‚ â­ 4.5 (1,234)    â”‚â”‚                                 â”‚
â”‚  â”‚ ğŸ“ 1.2 å…¬é‡Œ        â”‚â”‚                                 â”‚
â”‚  â”‚ ğŸ’° å…è²»            â”‚â”‚                                 â”‚
â”‚  â”‚ ğŸ• ç´„1å°æ™‚         â”‚â”‚                                 â”‚
â”‚  â”‚ [è©³æƒ…] [æ”¶è—] [åŠ å…¥] â”‚                                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚                                 â”‚
â”‚                         â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚                                 â”‚
â”‚  â”‚ ğŸ“¸ [åœ–ç‰‡]          â”‚â”‚                                 â”‚
â”‚  â”‚ ç¾…æ±æ—å ´            â”‚â”‚                                 â”‚
â”‚  â”‚ ...                â”‚â”‚                                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚                                 â”‚
â”‚                         â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 6.2.4 é é¢ 4: æˆ‘çš„è¡Œç¨‹ï¼ˆæœƒå“¡ï¼‰

**è·¯å¾‘**: `/trips`

**UI å¸ƒå±€**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [Logo]  æˆ‘çš„è¡Œç¨‹                  [ä½¿ç”¨è€…é ­åƒ â–¼]         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  æˆ‘çš„è¡Œç¨‹ (3)                    [+ å»ºç«‹æ–°è¡Œç¨‹]           â”‚
â”‚                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ğŸ“¸ [å°é¢åœ–]       å®œè˜­å…©æ—¥éŠ                        â”‚ â”‚
â”‚  â”‚                   2025-10-01 ~ 10-02               â”‚ â”‚
â”‚  â”‚                   å®œè˜­ â€¢ 2å¤© â€¢ 8å€‹æ™¯é»              â”‚ â”‚
â”‚  â”‚                                                     â”‚ â”‚
â”‚  â”‚                   [æª¢è¦–] [ç·¨è¼¯] [åˆ†äº«] [åˆªé™¤]      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ğŸ“¸ [å°é¢åœ–]       å°åŒ—ä¸‰æ—¥éŠ                        â”‚ â”‚
â”‚  â”‚                   2025-09-15 ~ 09-17               â”‚ â”‚
â”‚  â”‚                   å°åŒ— â€¢ 3å¤© â€¢ 12å€‹æ™¯é»             â”‚ â”‚
â”‚  â”‚                                                     â”‚ â”‚
â”‚  â”‚                   [æª¢è¦–] [ç·¨è¼¯] [åˆ†äº«] [åˆªé™¤]      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. åŠŸèƒ½æ¨¡çµ„è¨­è¨ˆ

### 7.1 æœƒå“¡èªè­‰æ¨¡çµ„

**è·è²¬**: è™•ç†ä½¿ç”¨è€…è¨»å†Šã€ç™»å…¥ã€OAuthã€æ¬Šé™ç®¡ç†

**æŠ€è¡“å¯¦ä½œ**:
- JWT Token èªè­‰
- OAuth 2.0 (Google, Facebook)
- å¯†ç¢¼åŠ å¯† (bcrypt)
- Session ç®¡ç† (Redis)

**æ ¸å¿ƒé¡åˆ¥**:

```python
# src/itinerary_planner/application/services/auth_service.py

class AuthService:
    def register_user(
        self, 
        email: str, 
        password: str, 
        username: str
    ) -> User:
        """è¨»å†Šæ–°ä½¿ç”¨è€…"""
        pass
    
    def login(
        self, 
        email: str, 
        password: str
    ) -> AuthToken:
        """ç™»å…¥ä¸¦è¿”å› Token"""
        pass
    
    def verify_token(
        self, 
        token: str
    ) -> User:
        """é©—è­‰ JWT Token"""
        pass
    
    def oauth_login(
        self, 
        provider: str, 
        oauth_token: str
    ) -> AuthToken:
        """OAuth ç™»å…¥"""
        pass
```

### 7.2 è¡Œç¨‹ç®¡ç†æ¨¡çµ„

**è·è²¬**: æœƒå“¡è¡Œç¨‹çš„ CRUDã€åˆ†äº«ã€è¤‡è£½

**æ ¸å¿ƒé¡åˆ¥**:

```python
# src/itinerary_planner/application/services/trip_service.py

class TripService:
    def create_trip(
        self, 
        user_id: str, 
        trip_data: TripCreateRequest
    ) -> Trip:
        """å»ºç«‹æ–°è¡Œç¨‹"""
        pass
    
    def get_user_trips(
        self, 
        user_id: str, 
        skip: int = 0, 
        limit: int = 10
    ) -> List[Trip]:
        """å–å¾—ä½¿ç”¨è€…çš„è¡Œç¨‹åˆ—è¡¨"""
        pass
    
    def update_trip(
        self, 
        trip_id: str, 
        user_id: str, 
        updates: TripUpdateRequest
    ) -> Trip:
        """æ›´æ–°è¡Œç¨‹"""
        pass
    
    def share_trip(
        self, 
        trip_id: str, 
        user_id: str
    ) -> str:
        """åˆ†äº«è¡Œç¨‹ï¼Œè¿”å›å…¬é–‹é€£çµ"""
        pass
    
    def copy_trip(
        self, 
        trip_id: str, 
        user_id: str
    ) -> Trip:
        """è¤‡è£½è¡Œç¨‹"""
        pass
```

### 7.3 æ™¯é»æ¨è–¦æ¨¡çµ„

**è·è²¬**: åŸºæ–¼ä½ç½®ã€èˆˆè¶£ã€è¡Œç‚ºçš„æ™¯é»æ¨è–¦

**æ¨è–¦ç­–ç•¥**:

1. **åŸºæ–¼ä½ç½®**:
   - PostGIS åŠå¾‘æŸ¥è©¢
   - è·é›¢æ’åº

2. **åŸºæ–¼èˆˆè¶£**:
   - ä½¿ç”¨è€…åå¥½åŒ¹é…
   - é¡åˆ¥éæ¿¾

3. **åŸºæ–¼è¡Œç‚º**ï¼ˆæœªä¾†æ“´å±•ï¼‰:
   - å”åŒéæ¿¾
   - ç†±é–€æ™¯é»

**æ ¸å¿ƒé¡åˆ¥**:

```python
# src/itinerary_planner/application/services/recommendation_service.py

class RecommendationService:
    def get_nearby_places(
        self, 
        lat: float, 
        lon: float, 
        radius: int = 5000,
        categories: List[str] = None,
        user_id: str = None  # å¯é¸ï¼Œæœƒå“¡å¯äº«å€‹æ€§åŒ–
    ) -> List[Place]:
        """å–å¾—é™„è¿‘æ™¯é»"""
        pass
    
    def get_personalized_recommendations(
        self, 
        user_id: str, 
        location: Optional[Tuple[float, float]] = None
    ) -> List[Place]:
        """å€‹æ€§åŒ–æ¨è–¦"""
        pass
```

### 7.4 å°è©±ç‹€æ…‹ç®¡ç†æ¨¡çµ„ï¼ˆæ•´åˆç¾æœ‰ï¼‰

**è·è²¬**: ç®¡ç† LangGraph å°è©±ç‹€æ…‹ã€Session ç®¡ç†

**Session æŒä¹…åŒ–**:
- Redis: çŸ­æœŸ Sessionï¼ˆ1å°æ™‚ï¼‰
- PostgreSQL: é•·æœŸå°è©±è¨˜éŒ„

---

## 8. éƒ¨ç½²æ¶æ§‹

### 8.1 å®¹å™¨åŒ–éƒ¨ç½²

**Docker Compose æœå‹™**:

```yaml
version: '3.8'

services:
  # å¾Œç«¯ API
  api:
    build: .
    ports:
      - "8000:8000"
    environment:
      - DATABASE_URL=postgresql://user:pass@db:5432/itinerary
      - REDIS_URL=redis://redis:6379
      - JWT_SECRET=${JWT_SECRET}
    depends_on:
      - db
      - redis
      - osrm
  
  # PostgreSQL + PostGIS
  db:
    image: postgis/postgis:14-3.3
    volumes:
      - postgres_data:/var/lib/postgresql/data
    environment:
      - POSTGRES_USER=user
      - POSTGRES_PASSWORD=pass
      - POSTGRES_DB=itinerary
  
  # Redis
  redis:
    image: redis:7-alpine
    volumes:
      - redis_data:/data
  
  # OSRM
  osrm:
    image: osrm/osrm-backend
    volumes:
      - ./data/osrm:/data
    command: osrm-routed --algorithm mld /data/taiwan.osrm
  
  # å‰ç«¯ï¼ˆNginxï¼‰
  frontend:
    image: nginx:alpine
    volumes:
      - ./frontend/dist:/usr/share/nginx/html
    ports:
      - "80:80"
    depends_on:
      - api

volumes:
  postgres_data:
  redis_data:
```

### 8.2 ç”Ÿç”¢ç’°å¢ƒæ¶æ§‹

```mermaid
graph TB
    subgraph "ç”¨æˆ¶ç«¯"
        Browser[ç€è¦½å™¨]
        Mobile[æ‰‹æ©Ÿ]
    end
    
    subgraph "CDN & è² è¼‰å‡è¡¡"
        CDN[CloudFlare CDN]
        LB[Nginx Load Balancer]
    end
    
    subgraph "æ‡‰ç”¨å±¤ï¼ˆå¤šå¯¦ä¾‹ï¼‰"
        API1[API Server 1]
        API2[API Server 2]
        API3[API Server 3]
    end
    
    subgraph "è³‡æ–™å±¤"
        DBMaster[(PostgreSQL Master)]
        DBReplica[(PostgreSQL Replica)]
        RedisCluster[Redis Cluster]
    end
    
    subgraph "æœå‹™å±¤"
        OSRM[OSRM Service]
        VectorDB[(Milvus)]
    end
    
    Browser --> CDN
    Mobile --> CDN
    CDN --> LB
    LB --> API1
    LB --> API2
    LB --> API3
    
    API1 --> DBMaster
    API2 --> DBReplica
    API3 --> RedisCluster
    
    API1 --> OSRM
    API2 --> VectorDB
```

### 8.3 ç›£æ§èˆ‡æ—¥èªŒ

**ç›£æ§æŒ‡æ¨™**:
- API å›æ‡‰æ™‚é–“ã€éŒ¯èª¤ç‡
- è³‡æ–™åº«æŸ¥è©¢æ•ˆèƒ½
- Redis å¿«å–å‘½ä¸­ç‡
- ä½¿ç”¨è€…è¨»å†Šã€æ´»èºåº¦

**å·¥å…·**:
- Prometheus + Grafanaï¼ˆæŒ‡æ¨™ï¼‰
- ELK Stackï¼ˆæ—¥èªŒï¼‰
- Sentryï¼ˆéŒ¯èª¤è¿½è¹¤ï¼‰

---

## 9. é–‹ç™¼è·¯ç·šåœ–

### Phase 1: MVPï¼ˆ4é€±ï¼‰
- âœ… åŸºç¤è¡Œç¨‹è¦åŠƒ API
- âœ… å°è©±å¼ä¿®æ”¹
- âœ… æ™¯é»è³‡æ–™åº«
- ğŸ”² æœƒå“¡ç³»çµ±ï¼ˆè¨»å†Šã€ç™»å…¥ï¼‰
- ğŸ”² è¡Œç¨‹å„²å­˜åŠŸèƒ½
- ğŸ”² åŸºæœ¬å‰ç«¯é é¢

### Phase 2: å¢å¼·åŠŸèƒ½ï¼ˆ4é€±ï¼‰
- ğŸ”² é™„è¿‘æ™¯é»æ¨è–¦
- ğŸ”² æ™¯é»æ”¶è—
- ğŸ”² è¡Œç¨‹åˆ†äº«
- ğŸ”² å€‹æ€§åŒ–æ¨è–¦
- ğŸ”² åœ°åœ–è¦–è¦ºåŒ–

### Phase 3: å„ªåŒ–èˆ‡æ“´å±•ï¼ˆæŒçºŒï¼‰
- ğŸ”² å”åŒéæ¿¾æ¨è–¦
- ğŸ”² ç¤¾äº¤åŠŸèƒ½ï¼ˆè¡Œç¨‹è¨è«–ï¼‰
- ğŸ”² å¤šèªè¨€æ”¯æ´
- ğŸ”² ç§»å‹• App

---

## 10. å®‰å…¨æ€§è€ƒé‡

### 10.1 èªè­‰èˆ‡æˆæ¬Š
- JWT Token with éæœŸæ©Ÿåˆ¶
- HTTPS Only
- CORS æ”¿ç­–
- Rate Limiting

### 10.2 è³‡æ–™å®‰å…¨
- å¯†ç¢¼ bcrypt åŠ å¯†
- æ•æ„Ÿè³‡æ–™æ¬„ä½åŠ å¯†ï¼ˆJSONBï¼‰
- SQL Injection é˜²è­·ï¼ˆORMï¼‰
- XSS é˜²è­·ï¼ˆå‰ç«¯è¼¸å…¥é©—è­‰ï¼‰

### 10.3 éš±ç§ä¿è­·
- GDPR åˆè¦
- è³‡æ–™åŒ¿ååŒ–é¸é …
- ä½¿ç”¨è€…è³‡æ–™åŒ¯å‡º/åˆªé™¤

---

## ç¸½çµ

æœ¬ç³»çµ±æ¶æ§‹è¨­è¨ˆæ¶µè“‹äº†ï¼š

1. âœ… **å®Œæ•´çš„ä½¿ç”¨è€…æµç¨‹**: å¾è¼¸å…¥è³‡æ–™ â†’ ç”Ÿæˆè¡Œç¨‹ â†’ å°è©±ä¿®æ”¹ â†’ å„²å­˜ç®¡ç†
2. âœ… **æ™¯é»æ¨è–¦åŠŸèƒ½**: åŸºæ–¼ä½ç½®ã€èˆˆè¶£çš„æ™ºæ…§æ¨è–¦
3. âœ… **æœƒå“¡ç³»çµ±**: å®Œæ•´çš„èªè­‰ã€è¡Œç¨‹ç®¡ç†ã€å€‹äººåŒ–é«”é©—
4. âœ… **æ“´å±•æ€§**: æ¨¡çµ„åŒ–è¨­è¨ˆï¼Œä¾¿æ–¼æœªä¾†åŠŸèƒ½æ“´å±•
5. âœ… **æŠ€è¡“å®Œæ•´æ€§**: å¾å‰ç«¯åˆ°å¾Œç«¯ã€è³‡æ–™åº«åˆ°éƒ¨ç½²çš„å…¨æ–¹ä½è¨­è¨ˆ

ä¸‹ä¸€æ­¥å¯ä»¥é–‹å§‹å¯¦ä½œæœƒå“¡ç³»çµ±çš„æ ¸å¿ƒåŠŸèƒ½ã€‚
