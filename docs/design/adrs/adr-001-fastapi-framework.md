# ADR-001: 選擇 FastAPI 作為後端 API 框架

---

**狀態:** `已接受 (Accepted)`
**決策者:** `使用者, Gemini`
**日期:** `2025-09-24`

---

## 1. 背景與問題陳述

本專案「智慧旅遊行程規劃器」的核心是一個 API 服務，它需要接收客戶端的對話式請求，並快速回應生成的行程。我們需要一個現代、高性能、易於開發和維護的 Python Web 框架。

**問題陳述:** 如何選擇一個能夠滿足性能要求、支援非同步操作（以應對 I/O 密集的 LLM 和外部 API 呼叫），並且開發效率高的後端框架？

## 2. 考量的選項

### 選項一：FastAPI
- **描述:** 一個基於 Starlette 和 Pydantic 的現代 Python Web 框架。
- **優點:**
    - **高性能:** 基於 ASGI，性能與 NodeJS、Go 相當。
    - **非同步支援:** 原生支援 `async/await`，非常適合 I/O 密集型任務。
    - **開發效率:** 基於 Pydantic 的自動資料驗證、序列化和 API 文件生成（Swagger UI, ReDoc）能極大提升開發速度。
    - **型別提示:** 強依賴 Python 型別提示，代碼更健壯、易維護。
- **缺點:**
    - **社群與生態:** 相較於 Django 和 Flask，社群歷史較短，但增長迅速。

### 選項二：Flask
- **描述:** 一個輕量級的 WSGI Python Web 框架。
- **優點:**
    - **靈活:** 核心簡單，可自由組合擴展。
    - **社群龐大:** 擁有非常龐大的社群和豐富的插件。
- **缺點:**
    - **非同步支援:** 需要額外配置（如 Gevent）或在 Flask 2.0+ 中支援，但不如 FastAPI 原生。
    - **無內建驗證:** 資料驗證和序列化需要引入第三方庫（如 Marshmallow），增加了整合成本。
    - **手動文件:** API 文件需要手動編寫或整合其他工具。

### 選項三：Django
- **描述:** 一個功能齊全的「大而全」Python Web 框架。
- **優點:**
    - **功能完備:** 自帶 ORM、Admin 後台等，開箱即用。
    - **生態成熟:** 擁有最成熟的生態系統。
- **缺點:**
    - **過於笨重:** 對於一個純 API 服務來說，其許多功能（如模板、Admin）並非必需。
    - **非同步支援:** 從 Django 3.1 開始逐步支援，但整體生態仍以同步為主。

## 3. 決策

**最終選擇的方案：** 選項一：FastAPI。

**選擇理由:**
FastAPI 的核心優勢與本專案的需求高度契合。
1.  **性能與非同步:** 本專案大量依賴對 LLM API、OSRM 和資料庫的呼叫，這些都是 I/O 密集型操作。FastAPI 的原生非同步能力是最高優先級的考量。
2.  **開發效率:** Pydantic 的整合是殺手級特性。我們需要處理複雜的 `Story` 和 `Itinerary` 資料結構，Pydantic 的自動驗證和序列化能顯著減少樣板代碼。同時，自動生成的 API 文件也簡化了開發與調試。
3.  **現代化:** FastAPI 的設計理念（基於 OpenAPI 標準、依賴注入）符合現代 API 開發的最佳實踐。

雖然 Flask 和 Django 社群更為龐大，但 FastAPI 在性能和針對 API 開發的效率上提供了壓倒性的優勢，其快速增長的社群也足以應對未來可能遇到的問題。

## 4. 決策的後果與影響

- **正面影響:** 開發團隊可以專注於業務邏輯，而不是框架的樣板代碼。系統性能從一開始就建立在一個高起點上。
- **負面影響/風險:** 暫無明顯的負面影響。團隊需要熟悉 FastAPI 的依賴注入系統和 Pydantic 的使用。
