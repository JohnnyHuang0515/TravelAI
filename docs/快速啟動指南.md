# ğŸš€ æ™ºæ…§æ—…éŠè¡Œç¨‹è¦åŠƒç³»çµ± - å¿«é€Ÿå•Ÿå‹•æŒ‡å—

**æ›´æ–°æ—¥æœŸ**: 2025-09-30  
**ç³»çµ±ç‰ˆæœ¬**: v2.0 - å®Œæ•´æœƒå“¡ç³»çµ±

---

## ğŸ“‹ å‰ç½®éœ€æ±‚

- Python 3.10+
- PostgreSQL 14+ï¼ˆå« PostGISï¼‰
- Redis 7+
- Docker & Docker Composeï¼ˆæ¨è–¦ï¼‰

---

## âš¡ å¿«é€Ÿå•Ÿå‹•ï¼ˆ5 åˆ†é˜ï¼‰

### Step 1: å•Ÿå‹•åŸºç¤æœå‹™

```bash
# å•Ÿå‹• PostgreSQL å’Œ Redis
docker-compose up -d db redis osrm
```

### Step 2: å®‰è£ Python ä¾è³´

```bash
# å®‰è£ä¾è³´
pip install -r requirements.txt
```

### Step 3: åŸ·è¡Œè³‡æ–™åº« Migration

```bash
# å»ºç«‹æœƒå“¡ç³»çµ±è³‡æ–™è¡¨
python3 scripts/run_migration.py 001_create_user_system_tables
```

### Step 4: å•Ÿå‹• API æœå‹™

```bash
# å•Ÿå‹•æœå‹™å™¨
python3 start_server.py
```

### Step 5: æ¸¬è©¦ç³»çµ±

```bash
# åŸ·è¡Œå®Œæ•´æµç¨‹æ¸¬è©¦
python3 scripts/test_complete_flow.py
```

### Step 6: æŸ¥çœ‹ API æ–‡ä»¶

è¨ªå• http://localhost:8000/docs

---

## ğŸ“š å®Œæ•´å•Ÿå‹•æ­¥é©Ÿ

### 1. ç’°å¢ƒè¨­å®š

```bash
# è¨­å®šç’°å¢ƒè®Šæ•¸
export DATABASE_URL="postgresql://postgres:password@localhost:5432/itinerary_db"
export REDIS_URL="redis://localhost:6379"
export OSRM_HOST="http://localhost:5000"
export JWT_SECRET="your-super-secret-key-min-32-characters"
export GEMINI_API_KEY="your-gemini-api-key"
```

### 2. è³‡æ–™åº«åˆå§‹åŒ–

```bash
# 2.1 å•Ÿå‹• PostgreSQL
docker-compose up -d db

# 2.2 åŸ·è¡Œ Migrationï¼ˆå»ºç«‹æœƒå“¡ç³»çµ±è¡¨ï¼‰
python3 scripts/run_migration.py 001_create_user_system_tables

# 2.3 é©—è­‰è¡¨æ ¼å·²å»ºç«‹
psql postgresql://postgres:password@localhost:5432/itinerary_db -c "\dt"
```

### 3. è³‡æ–™åŒ¯å…¥ï¼ˆå¦‚éœ€è¦ï¼‰

```bash
# 3.1 åŒ¯å…¥æ™¯é»è³‡æ–™
python3 scripts/import_data.py

# 3.2 åŒ¯å…¥ä½å®¿è³‡æ–™
python3 scripts/import_accommodation_data.py

# 3.3 ç”Ÿæˆå‘é‡ Embeddingsï¼ˆå¯é¸ï¼‰
python3 scripts/generate_embeddings.py
```

### 4. OSRM è·¯ç¶²è³‡æ–™

```bash
# 4.1 è™•ç† OSRM è³‡æ–™ï¼ˆå¦‚æœé‚„æ²’è™•ç†ï¼‰
bash process_osrm.sh

# 4.2 å•Ÿå‹• OSRM æœå‹™
docker-compose up -d osrm
```

### 5. å•Ÿå‹•æœå‹™

```bash
# å•Ÿå‹•æ‰€æœ‰æœå‹™
docker-compose up -d

# æˆ–åªå•Ÿå‹•å¾Œç«¯ API
python3 start_server.py
```

---

## ğŸ§ª æ¸¬è©¦ API

### æ–¹æ³• 1: ä½¿ç”¨æ¸¬è©¦è…³æœ¬

```bash
# èªè­‰ API æ¸¬è©¦
python3 scripts/test_auth_api.py

# å®Œæ•´æµç¨‹æ¸¬è©¦
python3 scripts/test_complete_flow.py
```

### æ–¹æ³• 2: ä½¿ç”¨ Swagger UI

è¨ªå• http://localhost:8000/docs

### æ–¹æ³• 3: ä½¿ç”¨ curl

```bash
# å¥åº·æª¢æŸ¥
curl http://localhost:8000/health

# è¨»å†Šä½¿ç”¨è€…
curl -X POST "http://localhost:8000/v1/auth/register" \
  -H "Content-Type: application/json" \
  -d '{
    "email": "test@example.com",
    "password": "testPass123",
    "username": "å°æ˜"
  }'

# ç™»å…¥
curl -X POST "http://localhost:8000/v1/auth/login" \
  -H "Content-Type: application/json" \
  -d '{
    "email": "test@example.com",
    "password": "testPass123"
  }'

# è¦åŠƒè¡Œç¨‹
curl -X POST "http://localhost:8000/v1/itinerary/propose" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "session_id": "test_session",
    "text": "æˆ‘æƒ³å»å®œè˜­ç©å…©å¤©"
  }'
```

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½æ¸¬è©¦æµç¨‹

### å®Œæ•´ä½¿ç”¨è€…æ—…ç¨‹

```
1. è¨»å†Šå¸³è™Ÿ
   â†“
2. è¨­å®šåå¥½ï¼ˆèˆˆè¶£ã€ç¯€å¥ã€é ç®—ï¼‰
   â†“
3. è¦åŠƒè¡Œç¨‹ï¼ˆAI è‡ªå‹•å¥—ç”¨åå¥½ï¼‰
   â†“
4. å°è©±ä¿®æ”¹è¡Œç¨‹
   â†“
5. å„²å­˜è¡Œç¨‹
   â†“
6. åˆ†äº«è¡Œç¨‹çµ¦æœ‹å‹
   â†“
7. æŸ¥çœ‹æˆ‘çš„è¡Œç¨‹åˆ—è¡¨
   â†“
8. é™„è¿‘æ™¯é»æ¨è–¦
   â†“
9. æ”¶è—å–œæ­¡çš„æ™¯é»
```

---

## ğŸ“Š API ç«¯é»ç¸½è¦½

### ğŸ” èªè­‰ APIï¼ˆ9å€‹ï¼‰
- POST /v1/auth/register
- POST /v1/auth/login
- POST /v1/auth/refresh
- POST /v1/auth/logout
- GET /v1/auth/me
- PUT /v1/auth/me
- POST /v1/auth/me/change-password
- GET /v1/auth/me/preferences
- PUT /v1/auth/me/preferences

### ğŸ“ è¡Œç¨‹ç®¡ç† APIï¼ˆ8å€‹ï¼‰
- POST /v1/trips
- GET /v1/trips
- GET /v1/trips/{trip_id}
- PUT /v1/trips/{trip_id}
- DELETE /v1/trips/{trip_id}
- POST /v1/trips/{trip_id}/share
- GET /v1/trips/public/{share_token}
- POST /v1/trips/{trip_id}/copy

### ğŸ“ æ™¯é»æ¨è–¦ APIï¼ˆ4å€‹ï¼‰
- GET /v1/places/nearby
- GET /v1/places/favorites
- POST /v1/places/{place_id}/favorite
- DELETE /v1/places/{place_id}/favorite

### ğŸ—ºï¸ è¡Œç¨‹è¦åŠƒ APIï¼ˆ2å€‹ï¼‰
- POST /v1/itinerary/propose âœ¨ æ”¯æ´æœƒå“¡å€‹æ€§åŒ–
- POST /v1/itinerary/feedback

**ç¸½è¨ˆ: 23 å€‹ API ç«¯é»**

---

## ğŸ”§ ç’°å¢ƒè®Šæ•¸è¨­å®š

å»ºç«‹ `.env` æª”æ¡ˆï¼š

```bash
# è¤‡è£½ç¯„ä¾‹æª”æ¡ˆ
cp .env.example .env

# ç·¨è¼¯è¨­å®š
nano .env
```

å¿…è¦è¨­å®šï¼š
- `DATABASE_URL` - PostgreSQL é€£ç·šå­—ä¸²
- `REDIS_URL` - Redis é€£ç·šå­—ä¸²
- `JWT_SECRET` - JWT å¯†é‘°ï¼ˆè‡³å°‘ 32 å­—å…ƒï¼‰
- `GEMINI_API_KEY` - Google Gemini API Key

---

## ğŸ› å¸¸è¦‹å•é¡Œ

### Q1: è³‡æ–™åº«é€£ç·šå¤±æ•—

```bash
# æª¢æŸ¥ PostgreSQL æ˜¯å¦å•Ÿå‹•
docker-compose ps db

# æª¢æŸ¥é€£ç·š
psql postgresql://postgres:password@localhost:5432/itinerary_db -c "SELECT 1"
```

### Q2: OSRM æœå‹™ç„¡æ³•å•Ÿå‹•

```bash
# ç¢ºèª OSRM è³‡æ–™å·²è™•ç†
ls -lh data/osrm/taiwan*.osrm*

# å¦‚æœæ²’æœ‰ï¼ŒåŸ·è¡Œè™•ç†è…³æœ¬
bash process_osrm.sh
```

### Q3: Redis é€£ç·šå¤±æ•—

```bash
# å•Ÿå‹• Redis
docker-compose up -d redis

# æ¸¬è©¦é€£ç·š
redis-cli ping
```

### Q4: Migration å¤±æ•—

```bash
# æª¢æŸ¥æ˜¯å¦æœ‰è¡çªçš„è¡¨æ ¼
psql $DATABASE_URL -c "\dt"

# å¦‚éœ€é‡ç½®ï¼Œå…ˆ Rollback
psql $DATABASE_URL -f scripts/migrations/rollback_001.sql
```

---

## ğŸ“– ç›¸é—œæ–‡ä»¶

- [ç³»çµ±æ¶æ§‹è¨­è¨ˆæ–‡ä»¶](./ç³»çµ±æ¶æ§‹è¨­è¨ˆæ–‡ä»¶.md)
- [èªè­‰ API ä½¿ç”¨æŒ‡å—](./èªè­‰APIä½¿ç”¨æŒ‡å—.md)
- [å¿«é€Ÿé–‹å§‹-è³‡æ–™åº«è¨­å®š](./å¿«é€Ÿé–‹å§‹-è³‡æ–™åº«è¨­å®š.md)
- [æœƒå“¡ç³»çµ±æ•´åˆå®Œæˆ](./æœƒå“¡ç³»çµ±æ•´åˆå®Œæˆ.md)
- [TODO æ¸…å–®](../TODO.md)

---

## ğŸ‰ æ­å–œï¼

å¦‚æœæ‰€æœ‰æ¸¬è©¦é€šéï¼Œæ‚¨çš„æ™ºæ…§æ—…éŠè¡Œç¨‹è¦åŠƒç³»çµ±å¾Œç«¯å·²ç¶“å®Œæ•´é‹ä½œï¼

ä¸‹ä¸€æ­¥å¯ä»¥é–‹å§‹ï¼š
1. å‰ç«¯å°ˆæ¡ˆè¨­å®š
2. è¨­è¨ˆä½¿ç”¨è€…ä»‹é¢
3. æ•´åˆå‰å¾Œç«¯

**Happy Coding! ğŸš€**
