<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OSRM æ•´åˆæ¸¬è©¦</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }
        .test-section h3 {
            margin-top: 0;
            color: #555;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 6px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª OSRM æ•´åˆæ¸¬è©¦</h1>
        
        <div class="test-section">
            <h3>1. OSRM æœå‹™å¥åº·æª¢æŸ¥</h3>
            <button onclick="testOSRMHealth()">æ¸¬è©¦ OSRM æœå‹™</button>
            <div id="health-result" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>2. è·¯ç”±è¨ˆç®—æ¸¬è©¦</h3>
            <button onclick="testRouteCalculation()">è¨ˆç®—å°åŒ—åˆ°å®œè˜­è·¯ç·š</button>
            <div id="route-result" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>3. æ›¿ä»£è·¯ç·šæ¸¬è©¦</h3>
            <button onclick="testAlternativeRoutes()">ç²å–æ›¿ä»£è·¯ç·š</button>
            <div id="alternatives-result" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>4. å‰ç«¯æ•´åˆæ¸¬è©¦</h3>
            <button onclick="testFrontendIntegration()">æ¸¬è©¦å‰ç«¯æ•´åˆ</button>
            <div id="frontend-result" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>5. å®Œæ•´åŠŸèƒ½æ¸¬è©¦</h3>
            <button onclick="runFullTest()">é‹è¡Œå®Œæ•´æ¸¬è©¦</button>
            <div id="full-result" class="result" style="display: none;"></div>
        </div>
    </div>

    <script>
        const OSRM_BASE_URL = 'http://localhost:5001';
        const FRONTEND_URL = 'http://localhost:3000';

        function showResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = `result ${type}`;
            element.textContent = message;
        }

        async function testOSRMHealth() {
            try {
                showResult('health-result', 'æ­£åœ¨æ¸¬è©¦ OSRM æœå‹™...', 'info');
                
                // ä½¿ç”¨ç°¡å–®çš„è·¯ç”±è«‹æ±‚ä¾†æª¢æŸ¥æœå‹™ç‹€æ…‹ï¼ˆOSRM 5.22.0 æ²’æœ‰ /health ç«¯é»ï¼‰
                const response = await fetch(`${OSRM_BASE_URL}/route/v1/driving/121.5170,25.0478;121.5170,25.0478`);
                const data = await response.json();
                
                if (response.ok && data.code === 'Ok') {
                    showResult('health-result', `âœ… OSRM æœå‹™æ­£å¸¸é‹è¡Œ\n\nå›æ‡‰æ•¸æ“š:\n${JSON.stringify(data, null, 2)}`, 'success');
                } else {
                    showResult('health-result', `âŒ OSRM æœå‹™ç•°å¸¸\nç‹€æ…‹ç¢¼: ${response.status}\nå›æ‡‰: ${JSON.stringify(data)}`, 'error');
                }
            } catch (error) {
                showResult('health-result', `âŒ ç„¡æ³•é€£æ¥åˆ° OSRM æœå‹™\néŒ¯èª¤: ${error.message}`, 'error');
            }
        }

        async function testRouteCalculation() {
            try {
                showResult('route-result', 'æ­£åœ¨è¨ˆç®—å°åŒ—åˆ°å®œè˜­è·¯ç·š...', 'info');
                
                // å°åŒ—è»Šç«™åˆ°å®œè˜­è»Šç«™
                const coordinates = '121.5170,25.0478;121.7534,24.7548';
                const response = await fetch(`${OSRM_BASE_URL}/route/v1/driving/${coordinates}?alternatives=true`);
                const data = await response.json();
                
                if (response.ok && data.code === 'Ok') {
                    const route = data.routes[0];
                    const distanceKm = (route.distance / 1000).toFixed(2);
                    const durationMin = (route.duration / 60).toFixed(1);
                    
                    showResult('route-result', 
                        `âœ… è·¯ç”±è¨ˆç®—æˆåŠŸ\n\n` +
                        `è·é›¢: ${distanceKm} km\n` +
                        `æ™‚é–“: ${durationMin} åˆ†é˜\n` +
                        `æ›¿ä»£è·¯ç·š: ${data.routes.length - 1} æ¢\n\n` +
                        `è©³ç´°æ•¸æ“š:\n${JSON.stringify(data, null, 2)}`, 
                        'success'
                    );
                } else {
                    showResult('route-result', `âŒ è·¯ç”±è¨ˆç®—å¤±æ•—\nå›æ‡‰: ${JSON.stringify(data)}`, 'error');
                }
            } catch (error) {
                showResult('route-result', `âŒ è·¯ç”±è¨ˆç®—è«‹æ±‚å¤±æ•—\néŒ¯èª¤: ${error.message}`, 'error');
            }
        }

        async function testAlternativeRoutes() {
            try {
                showResult('alternatives-result', 'æ­£åœ¨ç²å–æ›¿ä»£è·¯ç·š...', 'info');
                
                const coordinates = '121.5170,25.0478;121.7534,24.7548';
                const response = await fetch(`${OSRM_BASE_URL}/route/v1/driving/${coordinates}?alternatives=true&max_alternatives=3`);
                const data = await response.json();
                
                if (response.ok && data.code === 'Ok') {
                    let result = `âœ… æ›¿ä»£è·¯ç·šç²å–æˆåŠŸ\n\n`;
                    result += `ç¸½è·¯ç·šæ•¸: ${data.routes.length}\n\n`;
                    
                    data.routes.forEach((route, index) => {
                        const distanceKm = (route.distance / 1000).toFixed(2);
                        const durationMin = (route.duration / 60).toFixed(1);
                        result += `è·¯ç·š ${index + 1}:\n`;
                        result += `  è·é›¢: ${distanceKm} km\n`;
                        result += `  æ™‚é–“: ${durationMin} åˆ†é˜\n`;
                        result += `  å¹¾ä½•é»æ•¸: ${route.geometry.coordinates.length}\n\n`;
                    });
                    
                    showResult('alternatives-result', result, 'success');
                } else {
                    showResult('alternatives-result', `âŒ æ›¿ä»£è·¯ç·šç²å–å¤±æ•—\nå›æ‡‰: ${JSON.stringify(data)}`, 'error');
                }
            } catch (error) {
                showResult('alternatives-result', `âŒ æ›¿ä»£è·¯ç·šè«‹æ±‚å¤±æ•—\néŒ¯èª¤: ${error.message}`, 'error');
            }
        }

        async function testFrontendIntegration() {
            try {
                showResult('frontend-result', 'æ­£åœ¨æ¸¬è©¦å‰ç«¯æ•´åˆ...', 'info');
                
                // æ¸¬è©¦å‰ç«¯é é¢
                const frontendResponse = await fetch(FRONTEND_URL);
                
                if (frontendResponse.ok) {
                    let result = `âœ… å‰ç«¯æœå‹™æ­£å¸¸é‹è¡Œ\n\n`;
                    
                    // æ¸¬è©¦å‰ç«¯æ˜¯å¦èƒ½è¨ªå• OSRM æœå‹™ï¼ˆè·¨åŸŸæ¸¬è©¦ï¼‰
                    try {
                        const testResponse = await fetch(`${OSRM_BASE_URL}/health`);
                        if (testResponse.ok) {
                            result += `âœ… å‰ç«¯å¯ä»¥è¨ªå• OSRM æœå‹™\n`;
                        } else {
                            result += `âš ï¸ å‰ç«¯ç„¡æ³•è¨ªå• OSRM æœå‹™ (ç‹€æ…‹ç¢¼: ${testResponse.status})\n`;
                        }
                    } catch (corsError) {
                        result += `âš ï¸ è·¨åŸŸè«‹æ±‚è¢«é˜»æ­¢: ${corsError.message}\n`;
                        result += `ğŸ’¡ é€™æ˜¯æ­£å¸¸çš„ï¼Œå‰ç«¯æœƒé€šéä»£ç†æˆ–ç›´æ¥èª¿ç”¨ OSRM\n`;
                    }
                    
                    result += `\nå‰ç«¯åœ°å€: ${FRONTEND_URL}\n`;
                    result += `OSRM åœ°å€: ${OSRM_BASE_URL}\n`;
                    
                    showResult('frontend-result', result, 'success');
                } else {
                    showResult('frontend-result', `âŒ å‰ç«¯æœå‹™ç•°å¸¸\nç‹€æ…‹ç¢¼: ${frontendResponse.status}`, 'error');
                }
            } catch (error) {
                showResult('frontend-result', `âŒ å‰ç«¯æ•´åˆæ¸¬è©¦å¤±æ•—\néŒ¯èª¤: ${error.message}`, 'error');
            }
        }

        async function runFullTest() {
            showResult('full-result', 'æ­£åœ¨é‹è¡Œå®Œæ•´æ¸¬è©¦...', 'info');
            
            let results = [];
            
            // 1. å¥åº·æª¢æŸ¥
            try {
                const healthResponse = await fetch(`${OSRM_BASE_URL}/health`);
                if (healthResponse.ok) {
                    results.push('âœ… OSRM æœå‹™å¥åº·æª¢æŸ¥é€šé');
                } else {
                    results.push('âŒ OSRM æœå‹™å¥åº·æª¢æŸ¥å¤±æ•—');
                }
            } catch (error) {
                results.push('âŒ OSRM æœå‹™å¥åº·æª¢æŸ¥å¤±æ•—');
            }
            
            // 2. è·¯ç”±è¨ˆç®—
            try {
                const coordinates = '121.5170,25.0478;121.7534,24.7548';
                const routeResponse = await fetch(`${OSRM_BASE_URL}/route/v1/driving/${coordinates}`);
                const routeData = await routeResponse.json();
                
                if (routeResponse.ok && routeData.code === 'Ok') {
                    const distance = (routeData.routes[0].distance / 1000).toFixed(2);
                    const duration = (routeData.routes[0].duration / 60).toFixed(1);
                    results.push(`âœ… è·¯ç”±è¨ˆç®—æˆåŠŸ (${distance}km, ${duration}åˆ†é˜)`);
                } else {
                    results.push('âŒ è·¯ç”±è¨ˆç®—å¤±æ•—');
                }
            } catch (error) {
                results.push('âŒ è·¯ç”±è¨ˆç®—å¤±æ•—');
            }
            
            // 3. å‰ç«¯æœå‹™
            try {
                const frontendResponse = await fetch(FRONTEND_URL);
                if (frontendResponse.ok) {
                    results.push('âœ… å‰ç«¯æœå‹™æ­£å¸¸é‹è¡Œ');
                } else {
                    results.push('âŒ å‰ç«¯æœå‹™ç•°å¸¸');
                }
            } catch (error) {
                results.push('âŒ å‰ç«¯æœå‹™ç•°å¸¸');
            }
            
            // 4. æ•´åˆç‹€æ…‹
            const passedTests = results.filter(r => r.startsWith('âœ…')).length;
            const totalTests = results.length;
            
            let finalResult = `ğŸ¯ å®Œæ•´æ¸¬è©¦çµæœ\n\n`;
            finalResult += results.join('\n');
            finalResult += `\n\nğŸ“Š ç¸½çµ: ${passedTests}/${totalTests} é …æ¸¬è©¦é€šé\n`;
            
            if (passedTests === totalTests) {
                finalResult += `ğŸ‰ æ‰€æœ‰æ¸¬è©¦é€šéï¼OSRM æ•´åˆåŠŸèƒ½æ­£å¸¸é‹è¡Œ`;
                showResult('full-result', finalResult, 'success');
            } else {
                finalResult += `âš ï¸ éƒ¨åˆ†æ¸¬è©¦å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç›¸é—œæœå‹™`;
                showResult('full-result', finalResult, 'error');
            }
        }

        // é é¢è¼‰å…¥æ™‚è‡ªå‹•é‹è¡Œå¥åº·æª¢æŸ¥
        window.onload = function() {
            testOSRMHealth();
        };
    </script>
</body>
</html>
